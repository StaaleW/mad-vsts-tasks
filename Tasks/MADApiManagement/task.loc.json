{
  "id": "534EA5ED-F152-4A24-B9E7-913C74B1E56C",
  "name": "MADApiManagement",
  "friendlyName": "ms-resource:loc.friendlyName",
  "description": "ms-resource:loc.description",
  "helpMarkDown": "ms-resource:loc.helpMarkDown",
  "category": "Utility",
  "author": "Statoil MAD",
  "version": {
    "Major": 0,
    "Minor": 1,
    "Patch": 18
  },
  "preview": "true",
  "instanceNameFormat": "ms-resource:loc.instanceNameFormat",
  "groups": [
    {
      "name": "advanced",
      "displayName": "ms-resource:loc.group.displayName.advanced",
      "isExpanded": false
    }
  ],
  "inputs": [
    {
      "name": "ConnectedServiceNameSelector",
      "type": "pickList",
      "label": "ms-resource:loc.input.label.ConnectedServiceNameSelector",
      "required": false,
      "helpMarkDown": "",
      "defaultValue": "ConnectedServiceName",
      "options": {
        "ConnectedServiceNameClassic": "Azure Classic",
        "ConnectedServiceName": "Azure Resource Manager"
      }
    },
    {
      "name": "ConnectedServiceNameClassic",
      "type": "connectedService:Azure",
      "label": "ms-resource:loc.input.label.ConnectedServiceNameClassic",
      "defaultValue": "",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ConnectedServiceNameClassic",
      "visibleRule": "ConnectedServiceNameSelector = ConnectedServiceNameClassic"
    },
    {
      "name": "ConnectedServiceName",
      "type": "connectedService:AzureRM",
      "label": "ms-resource:loc.input.label.ConnectedServiceName",
      "defaultValue": "",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ConnectedServiceName",
      "visibleRule": "ConnectedServiceNameSelector = ConnectedServiceName"
    },
    {
      "name": "WebAppName",
      "type": "pickList",
      "label": "ms-resource:loc.input.label.WebAppName",
      "defaultValue": "",
      "required": true,
      "properties": {
        "EditableOptions": "True"
      },
      "helpMarkDown": "ms-resource:loc.input.help.WebAppName"
    },
    {
      "name": "ResourceGroupName",
      "type": "pickList",
      "label": "ms-resource:loc.input.label.ResourceGroupName",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ResourceGroupName",
      "properties": {
        "EditableOptions": "True"
      }
    },
    {
      "name": "ApiManagement",
      "type": "pickList",
      "label": "ms-resource:loc.input.label.ApiManagement",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ApiManagement",
      "properties": {
        "EditableOptions": "True"
      }
    },
    {
      "name": "ApiName",
      "type": "pickList",
      "label": "ms-resource:loc.input.label.ApiName",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ApiName",
      "properties": {
        "EditableOptions": "True"
      }
    },
    {
      "name": "ApiPath",
      "type": "string",
      "label": "ms-resource:loc.input.label.ApiPath",
      "required": true,
      "helpMarkDown": "ms-resource:loc.input.help.ApiPath"
    }
  ],
  "dataSourceBindings": [
    {
      "target": "WebAppName",
      "endpointId": "$(ConnectedServiceName)",
      "dataSourceName": "AzureRMWebAppNames"
    },
    {
      "target": "ResourceGroupName",
      "endpointId": "$(ConnectedServiceName)",
      "dataSourceName": "AzureResourceGroups"
    },
    {
      "target": "ApiManagement",
      "endpointId": "$(ConnectedServiceName)",
      "name": "apiResources",
      "endpointUrl": "{{endpoint.url}}/subscriptions/$(endpoint.subscriptionId)/resourceGroups/$(ResourceGroupName)/providers/Microsoft.ApiManagement/service/?api-version=2016-10-10",
      "resultSelector": "jsonpath:$.value[*].name",
      "parameters": {
        "ResourceGroupName": "$(ResourceGroupName)"
      }
    },
    {
      "target": "ApiName",
      "name": "availableApis",
      "endpointId": "$(ConnectedServiceName)",
      "endpointUrl": "{{endpoint.url}}/subscriptions/$(endpoint.subscriptionId)/resourceGroups/$(ResourceGroupName)/providers/Microsoft.ApiManagement/service/$(ApiManagement)/apis/?api-version=2016-10-10",
      "resultSelector": "jsonpath:$.value[*].name",
      "parameters": {
        "ApiManagement": "$(ApiManagement)"
      }
    }
  ],
  "execution": {
    "PowerShell3": {
      "target": "ConfigureApiManagement.ps1"
    }
  },
  "messages": {
    "AppAlreadyExists": "ms-resource:loc.messages.AppAlreadyExists"
  }
}